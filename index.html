<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Wide - Post-Construction Cleaning Calculator</title>
    <style>
        :root {
            --primary-blue: #1E3A8A;
            --secondary-blue: #3B82F6;
            --accent-red: #DC2626;
            --dark-gray: #374151;
            --light-gray: #F3F4F6;
            --success-green: #059669;
            --white: #FFFFFF;
            --warning-yellow: #F59E0B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--dark-gray);
            line-height: 1.6;
            background: var(--light-gray);
        }

        header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: var(--white);
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .card {
            background: var(--white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light-gray);
        }

        .card h3 {
            color: var(--dark-gray);
            margin: 1rem 0;
            font-size: 1.1rem;
        }

        /* Phase Selection Section */
        .phase-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .phase-card {
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .phase-card.selected {
            border-color: var(--secondary-blue);
            background: rgba(59, 130, 246, 0.05);
        }

        .phase-card h4 {
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
        }

        .phase-checkbox {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 24px;
            height: 24px;
        }

        /* Cost Provider Toggle Section */
        .cost-provider-section {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .toggle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .toggle-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toggle-group label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .toggle-buttons {
            display: flex;
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid #D1D5DB;
        }

        .toggle-buttons button {
            flex: 1;
            padding: 0.5rem;
            border: none;
            background: var(--white);
            color: var(--dark-gray);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .vendor-btn.active {
            background: var(--accent-red);
            color: var(--white);
        }

        .inhouse-btn.active {
            background: var(--success-green);
            color: var(--white);
        }

        /* Input Sections */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .input-group label {
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .input-group input,
        .input-group select {
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--secondary-blue);
        }

        /* IC Rate Breakdown */
        .ic-breakdown {
            background: var(--light-gray);
            border: 2px solid var(--secondary-blue);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background: var(--white);
            border-radius: 4px;
        }

        .breakdown-item .label {
            font-weight: 500;
            color: var(--dark-gray);
        }

        .breakdown-item .value {
            font-weight: 600;
            color: var(--primary-blue);
        }

        /* Results Section */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .result-card {
            background: var(--white);
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.3s;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .result-card.highlight {
            border-color: var(--accent-red);
            background: rgba(220, 38, 38, 0.05);
        }

        .result-card h4 {
            color: var(--dark-gray);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-card .value {
            color: var(--primary-blue);
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }

        .result-card.highlight .value {
            color: var(--accent-red);
        }

        .result-card .subtitle {
            color: #6B7280;
            font-size: 0.85rem;
        }

        /* Phase Summary Cards */
        .phase-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .phase-summary-card {
            background: linear-gradient(135deg, var(--light-gray) 0%, var(--white) 100%);
            border-left: 4px solid var(--secondary-blue);
            padding: 1rem;
            border-radius: 4px;
        }

        .phase-summary-card h4 {
            color: var(--primary-blue);
            margin-bottom: 0.75rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            font-size: 0.95rem;
        }

        /* Export Buttons */
        .export-section {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .export-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--white);
        }

        .export-btn.vendor {
            background: var(--secondary-blue);
        }

        .export-btn.client {
            background: var(--primary-blue);
        }

        .export-btn.fsm {
            background: var(--success-green);
        }

        .export-btn.scope {
            background: var(--warning-yellow);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .container {
                padding: 1rem;
            }

            .input-grid,
            .results-grid,
            .phase-selector {
                grid-template-columns: 1fr;
            }

            .export-section {
                flex-direction: column;
            }

            .export-btn {
                width: 100%;
            }
        }

        /* Utility Classes */
        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .text-center { text-align: center; }
        .font-bold { font-weight: 700; }
        .text-small { font-size: 0.85rem; }
    </style>
</head>
<body>
    <header>
        <h1>City Wide Post-Construction Cleaning Calculator</h1>
        <p>Comprehensive Pricing for Commercial Properties - All Three Phases</p>
    </header>

    <div class="container">
        <!-- Phase Selection Section -->
        <div class="card">
            <h2>Phase Selection & Project Details</h2>
            
            <div class="phase-selector">
                <div class="phase-card selected" onclick="togglePhase('rough')">
                    <input type="checkbox" class="phase-checkbox" id="phaseRough" checked>
                    <h4>Phase 1: Rough Clean</h4>
                    <p class="text-small">Initial debris removal, sweeping, dust control, and basic preparation</p>
                    <p class="text-small"><strong>Timeline:</strong> 40-50% of project</p>
                    <p class="text-small"><strong>Rate:</strong> 200-300 sq ft/hour</p>
                </div>
                
                <div class="phase-card selected" onclick="togglePhase('final')">
                    <input type="checkbox" class="phase-checkbox" id="phaseFinal" checked>
                    <h4>Phase 2: Final Clean</h4>
                    <p class="text-small">Detailed cleaning, dusting, mopping, fixtures, HVAC cleaning</p>
                    <p class="text-small"><strong>Timeline:</strong> 40-45% of project</p>
                    <p class="text-small"><strong>Rate:</strong> 150-250 sq ft/hour</p>
                </div>
                
                <div class="phase-card selected" onclick="togglePhase('touchup')">
                    <input type="checkbox" class="phase-checkbox" id="phaseTouchup" checked>
                    <h4>Phase 3: Touch-Up</h4>
                    <p class="text-small">Final details, spot cleaning, inspection prep</p>
                    <p class="text-small"><strong>Timeline:</strong> 10-15% of project</p>
                    <p class="text-small"><strong>Rate:</strong> 300-400 sq ft/hour</p>
                </div>
            </div>

            <div class="input-grid">
                <div class="input-group">
                    <label for="squareFootage">Total Square Footage</label>
                    <input type="number" id="squareFootage" value="25000" min="1000" step="500" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="buildingType">Building Type</label>
                    <select id="buildingType" onchange="updateCalculations()">
                        <option value="office">Standard Office Building</option>
                        <option value="medical">Medical/Healthcare Facility</option>
                        <option value="retail">Retail/Commercial Space</option>
                        <option value="industrial">Industrial/Warehouse</option>
                        <option value="education">Educational Facility</option>
                        <option value="hospitality">Hotel/Hospitality</option>
                        <option value="datacenter">Data Center/Tech Facility</option>
                        <option value="highend">Class A/Luxury Office</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="buildingCondition">Post-Construction Condition</label>
                    <select id="buildingCondition" onchange="updateCalculations()">
                        <option value="light">Light - Minimal dust/debris</option>
                        <option value="moderate" selected>Moderate - Standard construction mess</option>
                        <option value="heavy">Heavy - Extensive debris/residue</option>
                        <option value="extreme">Extreme - Major renovation debris</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="buildingComplexity">Building Complexity</label>
                    <select id="buildingComplexity" onchange="updateCalculations()">
                        <option value="simple">Simple - Open floor plan, easy access</option>
                        <option value="moderate" selected>Moderate - Some obstacles, standard layout</option>
                        <option value="complex">Complex - Multiple rooms, difficult access</option>
                        <option value="verycomplex">Very Complex - High ceilings, specialized areas</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="floors">Number of Floors</label>
                    <input type="number" id="floors" value="1" min="1" max="100" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="timeOfService">Service Schedule</label>
                    <select id="timeOfService" onchange="updateCalculations()">
                        <option value="normal">Normal Hours (6am-6pm)</option>
                        <option value="evening">Evening (6pm-12am) +15%</option>
                        <option value="overnight">Overnight (12am-6am) +25%</option>
                        <option value="weekend">Weekend +20%</option>
                        <option value="emergency">Emergency/Rush +35%</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Cost Provider Toggle Section -->
        <div class="card">
            <h2>Cost Provider Selection</h2>
            <div class="cost-provider-section">
                <div class="toggle-grid">
                    <div class="toggle-group">
                        <label>Labor Provider</label>
                        <div class="toggle-buttons">
                            <button class="vendor-btn active" data-category="labor" onclick="toggleProvider('labor', 'vendor')">Vendor</button>
                            <button class="inhouse-btn" data-category="labor" onclick="toggleProvider('labor', 'inhouse')">In-House</button>
                        </div>
                    </div>
                    
                    <div class="toggle-group">
                        <label>Equipment Provider</label>
                        <div class="toggle-buttons">
                            <button class="vendor-btn active" data-category="equipment" onclick="toggleProvider('equipment', 'vendor')">Vendor</button>
                            <button class="inhouse-btn" data-category="equipment" onclick="toggleProvider('equipment', 'inhouse')">In-House</button>
                        </div>
                    </div>
                </div>
                <div style="background: var(--light-gray); padding: 1rem; margin-top: 1rem; border-radius: 4px;">
                    <p style="font-size: 0.9rem; color: var(--dark-gray); margin: 0;">
                        <strong>Note:</strong> Materials and supplies are automatically calculated at 10% of base labor cost and follow the labor provider selection.
                    </p>
                </div>
            </div>
        </div>

        <!-- Labor & Equipment Section -->
        <div class="card">
            <h2>Labor & Equipment Configuration</h2>
            
            <h3>Crew Configuration</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label for="crewSize">Standard Crew Size</label>
                    <select id="crewSize" onchange="updateCalculations()">
                        <option value="2">2 Person Crew</option>
                        <option value="3">3 Person Crew</option>
                        <option value="4" selected>4 Person Crew</option>
                        <option value="6">6 Person Crew</option>
                        <option value="8">8 Person Crew</option>
                        <option value="10">10 Person Crew</option>
                        <option value="15">15 Person Crew</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="supervisors">Number of Supervisors</label>
                    <input type="number" id="supervisors" value="1" min="0" max="5" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="specialists">Specialist Workers</label>
                    <input type="number" id="specialists" value="0" min="0" max="5" onchange="updateCalculations()">
                </div>
            </div>

            <h3>Labor Rates</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label for="laborRate">Base Labor Rate ($/hour)</label>
                    <input type="number" id="laborRate" value="18.00" min="15" max="35" step="0.50" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="supervisorRate">Supervisor Rate ($/hour)</label>
                    <input type="number" id="supervisorRate" value="23.00" min="20" max="40" step="0.50" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="specialistRate">Specialist Rate ($/hour)</label>
                    <input type="number" id="specialistRate" value="25.00" min="20" max="45" step="0.50" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="stateTax">State Income Tax (%)</label>
                    <input type="number" id="stateTax" value="0.00" min="0" max="15" step="0.1" onchange="updateCalculations()">
                </div>
            </div>

            <!-- IC Rate Breakdown -->
            <div class="ic-breakdown">
                <h3>Independent Contractor Rate Breakdown</h3>
                <div class="breakdown-grid">
                    <div class="breakdown-item">
                        <span class="label">Base Rate:</span>
                        <span class="value" id="breakdownBase">$18.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">FICA (7.65%):</span>
                        <span class="value" id="breakdownFICA">$1.38</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">FUTA (0.60%):</span>
                        <span class="value" id="breakdownFUTA">$0.11</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">Work Comp (2.50%):</span>
                        <span class="value" id="breakdownWC">$0.45</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">GL (0.50%):</span>
                        <span class="value" id="breakdownGL">$0.09</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">State Tax:</span>
                        <span class="value" id="breakdownState">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">Supplies/Equipment (10%):</span>
                        <span class="value" id="breakdownSupplies">$1.80</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">Subtotal:</span>
                        <span class="value" id="breakdownSubtotal">$21.83</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">IC Profit (10%):</span>
                        <span class="value" id="breakdownICProfit">$2.18</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="label">IC Loaded Rate:</span>
                        <span class="value" id="breakdownLoaded">$24.01</span>
                    </div>
                </div>
                <div style="background: var(--light-gray); padding: 1rem; margin-top: 1rem; border-radius: 4px;">
                    <p style="font-size: 0.9rem; color: var(--dark-gray); margin: 0;">
                        <strong>Note:</strong> Supplies/Equipment at 10% of base rate covers cleaning supplies, microfiber cloths, trash bags, basic vacuums, and disposable items. Major equipment rentals are charged separately.
                    </p>
                </div>
            </div>

            <h3>Major Equipment Requirements (Additional Charges)</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label for="floorScrubbers">Floor Scrubbers</label>
                    <select id="floorScrubbers" onchange="updateCalculations()">
                        <option value="0">None</option>
                        <option value="1" selected>1 Walk-Behind</option>
                        <option value="2">2 Walk-Behind</option>
                        <option value="1r">1 Ride-On</option>
                        <option value="2r">2 Ride-On</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="wetVacs">Wet/Dry Vacuums</label>
                    <input type="number" id="wetVacs" value="2" min="0" max="10" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="lifts">Lifts Required</label>
                    <select id="lifts" onchange="updateCalculations()">
                        <option value="none">None</option>
                        <option value="scissor">Scissor Lift</option>
                        <option value="boom">Boom Lift</option>
                        <option value="both">Both Types</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="sideBySide">Side-by-Side/Utility Vehicle</label>
                    <select id="sideBySide" onchange="updateCalculations()">
                        <option value="no">No</option>
                        <option value="yes">Yes - 1 Unit</option>
                        <option value="multiple">Yes - 2+ Units</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="dumpster">Dumpster Rental</label>
                    <select id="dumpster" onchange="updateCalculations()">
                        <option value="no">No - Client Provided</option>
                        <option value="small">10-15 Yard</option>
                        <option value="medium">20-30 Yard</option>
                        <option value="large">40 Yard</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="generators">Generators (if no power)</label>
                    <select id="generators" onchange="updateCalculations()">
                        <option value="no">Not Needed</option>
                        <option value="small">Small (5kW)</option>
                        <option value="large">Large (20kW)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- City Wide Margin Section -->
        <div class="card">
            <h2>City Wide Pricing Configuration</h2>
            
            <div class="input-grid">
                <div class="input-group">
                    <label for="cityWideMargin">City Wide Margin (%)</label>
                    <input type="number" id="cityWideMargin" value="35" min="20" max="60" step="1" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="icProfit">IC Profit & Overhead (%)</label>
                    <input type="number" id="icProfit" value="10" min="5" max="25" step="1" onchange="updateCalculations()">
                </div>
                
                <div class="input-group">
                    <label for="region">Regional Adjustment</label>
                    <select id="region" onchange="updateCalculations()">
                        <option value="rural">Rural (-25%)</option>
                        <option value="suburban">Suburban (-10%)</option>
                        <option value="standard" selected>Standard Market</option>
                        <option value="urban">Urban (+15%)</option>
                        <option value="major">Major Metro (+25%)</option>
                        <option value="nyc">NYC/SF Market (+35%)</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="competitionLevel">Competition Level</label>
                    <select id="competitionLevel" onchange="updateCalculations()">
                        <option value="low">Low - Premium pricing</option>
                        <option value="moderate" selected>Moderate - Market rates</option>
                        <option value="high">High - Competitive pricing</option>
                        <option value="aggressive">Aggressive - Win the bid</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Important Service Exclusions Warning -->
        <div class="card" style="border: 3px solid var(--accent-red); background: rgba(220, 38, 38, 0.05);">
            <h2 style="color: var(--accent-red);">⚠️ IMPORTANT: Service Inclusions & Exclusions</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1.5rem;">
                <div style="background: white; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--success-green);">
                    <h3 style="color: var(--success-green); margin-bottom: 1rem;">✓ INCLUDED in This Quote:</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 0.25rem 0;">✓ Construction debris removal</li>
                        <li style="padding: 0.25rem 0;">✓ Dust removal from all surfaces</li>
                        <li style="padding: 0.25rem 0;">✓ Sweeping and vacuuming all floors</li>
                        <li style="padding: 0.25rem 0;">✓ Wet mopping hard surface floors</li>
                        <li style="padding: 0.25rem 0;">✓ Basic carpet vacuuming</li>
                        <li style="padding: 0.25rem 0;">✓ Cleaning and disinfecting restrooms</li>
                        <li style="padding: 0.25rem 0;">✓ Cleaning HVAC vents and returns</li>
                        <li style="padding: 0.25rem 0;">✓ Wiping down walls and removing marks</li>
                        <li style="padding: 0.25rem 0;">✓ Cleaning light fixtures and ceiling fans</li>
                        <li style="padding: 0.25rem 0;">✓ Removing protective films/stickers</li>
                        <li style="padding: 0.25rem 0;">✓ Cleaning and polishing fixtures</li>
                        <li style="padding: 0.25rem 0;">✓ Kitchen and break room cleaning</li>
                        <li style="padding: 0.25rem 0;">✓ Trash removal and disposal</li>
                        <li style="padding: 0.25rem 0;">✓ Final touch-up and inspection</li>
                    </ul>
                </div>
                
                <div style="background: white; padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--accent-red);">
                    <h3 style="color: var(--accent-red); margin-bottom: 1rem;">✗ NOT INCLUDED - Quote Separately:</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ STRIP & WAX SERVICES</li>
                        <li style="padding: 0.25rem 0; margin-left: 1rem;">→ Use Strip & Wax Calculator</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ WINDOW CLEANING</li>
                        <li style="padding: 0.25rem 0; margin-left: 1rem;">→ Use Window Cleaning Calculator</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ CARPET CLEANING/EXTRACTION</li>
                        <li style="padding: 0.25rem 0; margin-left: 1rem;">→ Use Carpet Cleaning Calculator</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ PRESSURE WASHING</li>
                        <li style="padding: 0.25rem 0; margin-left: 1rem;">→ Use Pressure Washing Calculator</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ HIGH DUSTING (above 20ft)</li>
                        <li style="padding: 0.25rem 0; margin-left: 1rem;">→ Requires specialized equipment</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ EXTERIOR CLEANING</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ UPHOLSTERY CLEANING</li>
                        <li style="padding: 0.25rem 0; font-weight: bold; color: var(--accent-red);">✗ CONSTRUCTION MATERIAL DISPOSAL FEES</li>
                    </ul>
                </div>
            </div>
            
            <div style="background: var(--warning-yellow); color: white; padding: 1rem; border-radius: 4px; margin-top: 1.5rem; text-align: center;">
                <strong style="font-size: 1.1rem;">FSM ACTION REQUIRED: Calculate excluded services using appropriate specialized calculators and add to total project quote</strong>
            </div>
        </div>

        <!-- Phase-by-Phase Results -->
        <div class="card">
            <h2>Phase-by-Phase Breakdown</h2>
            
            <div class="phase-summary">
                <div class="phase-summary-card">
                    <h4>Phase 1: Rough Clean</h4>
                    <div class="summary-row">
                        <span>Labor Hours:</span>
                        <span id="roughHours">125</span>
                    </div>
                    <div class="summary-row">
                        <span>Production Rate:</span>
                        <span id="roughRate">250 sq ft/hr</span>
                    </div>
                    <div class="summary-row">
                        <span>Labor Cost:</span>
                        <span id="roughLabor">$2,500</span>
                    </div>
                    <div class="summary-row">
                        <span>Equipment Cost:</span>
                        <span id="roughEquipment">$500</span>
                    </div>
                    <div class="summary-row">
                        <span>Materials Cost:</span>
                        <span id="roughMaterials">$250</span>
                    </div>
                    <div class="summary-row">
                        <span><strong>Phase Total:</strong></span>
                        <span><strong id="roughTotal">$3,250</strong></span>
                    </div>
                </div>
                
                <div class="phase-summary-card">
                    <h4>Phase 2: Final Clean</h4>
                    <div class="summary-row">
                        <span>Labor Hours:</span>
                        <span id="finalHours">150</span>
                    </div>
                    <div class="summary-row">
                        <span>Production Rate:</span>
                        <span id="finalRate">200 sq ft/hr</span>
                    </div>
                    <div class="summary-row">
                        <span>Labor Cost:</span>
                        <span id="finalLabor">$3,000</span>
                    </div>
                    <div class="summary-row">
                        <span>Equipment Cost:</span>
                        <span id="finalEquipment">$750</span>
                    </div>
                    <div class="summary-row">
                        <span>Materials Cost:</span>
                        <span id="finalMaterials">$1,250</span>
                    </div>
                    <div class="summary-row">
                        <span><strong>Phase Total:</strong></span>
                        <span><strong id="finalTotal">$5,000</strong></span>
                    </div>
                </div>
                
                <div class="phase-summary-card">
                    <h4>Phase 3: Touch-Up</h4>
                    <div class="summary-row">
                        <span>Labor Hours:</span>
                        <span id="touchupHours">75</span>
                    </div>
                    <div class="summary-row">
                        <span>Production Rate:</span>
                        <span id="touchupRate">350 sq ft/hr</span>
                    </div>
                    <div class="summary-row">
                        <span>Labor Cost:</span>
                        <span id="touchupLabor">$1,500</span>
                    </div>
                    <div class="summary-row">
                        <span>Equipment Cost:</span>
                        <span id="touchupEquipment">$250</span>
                    </div>
                    <div class="summary-row">
                        <span>Materials Cost:</span>
                        <span id="touchupMaterials">$150</span>
                    </div>
                    <div class="summary-row">
                        <span><strong>Phase Total:</strong></span>
                        <span><strong id="touchupTotal">$1,900</strong></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overall Results -->
        <div class="card">
            <h2>Total Project Pricing</h2>
            
            <div class="results-grid">
                <div class="result-card">
                    <h4>Total Labor Hours</h4>
                    <div class="value" id="totalHours">350</div>
                    <div class="subtitle">All phases combined</div>
                </div>
                
                <div class="result-card">
                    <h4>Total Days</h4>
                    <div class="value" id="totalDays">11</div>
                    <div class="subtitle">With 4-person crew</div>
                </div>
                
                <div class="result-card">
                    <h4>Labor Cost</h4>
                    <div class="value" id="totalLabor">$7,000</div>
                    <div class="subtitle">All crew members</div>
                </div>
                
                <div class="result-card">
                    <h4>Equipment Cost</h4>
                    <div class="value" id="totalEquipment">$1,500</div>
                    <div class="subtitle">Rental & depreciation</div>
                </div>
                
                <div class="result-card">
                    <h4>Materials Cost</h4>
                    <div class="value" id="totalMaterials">$1,650</div>
                    <div class="subtitle">Chemicals & supplies</div>
                </div>
                
                <div class="result-card">
                    <h4>Total Cost to CW</h4>
                    <div class="value" id="totalCostToCW">$10,150</div>
                    <div class="subtitle">Before margin</div>
                </div>
                
                <div class="result-card">
                    <h4>Price Per Sq Ft</h4>
                    <div class="value" id="pricePerSqFt">$0.63</div>
                    <div class="subtitle">All phases</div>
                </div>
                
                <div class="result-card highlight">
                    <h4>Final Client Price</h4>
                    <div class="value" id="clientPrice">$15,615</div>
                    <div class="subtitle">With 35% margin</div>
                </div>
                
                <div class="result-card highlight">
                    <h4>CW Gross Profit</h4>
                    <div class="value" id="grossProfit">$5,465</div>
                    <div class="subtitle">35% margin</div>
                </div>
                
                <div class="result-card">
                    <h4>Vendor Payment</h4>
                    <div class="value" id="vendorPayment">$11,165</div>
                    <div class="subtitle">With IC profit</div>
                </div>
                
                <div class="result-card">
                    <h4>Per Phase Price</h4>
                    <div class="value" id="perPhaseAvg">$5,205</div>
                    <div class="subtitle">Average per phase</div>
                </div>
                
                <div class="result-card">
                    <h4>Profit Margin %</h4>
                    <div class="value" id="profitPercent">35%</div>
                    <div class="subtitle">City Wide margin</div>
                </div>
            </div>
        </div>

        <!-- Export Options -->
        <div class="card">
            <h2>Export Options</h2>
            <div class="export-section">
                <button class="export-btn vendor" onclick="exportVendorSpecs()">
                    Export Vendor Specifications
                </button>
                <button class="export-btn client" onclick="exportClientInstructions()">
                    Export Client Instructions
                </button>
                <button class="export-btn fsm" onclick="exportFSMSummary()">
                    Export FSM Job Summary
                </button>
                <button class="export-btn scope" onclick="generateScope()">
                    Generate Project Scope
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state for provider selections
        let providers = {
            labor: 'vendor',
            equipment: 'vendor'
        };

        // Phase selections
        let phases = {
            rough: true,
            final: true,
            touchup: true
        };

        // Store calculation results for exports
        let calculationResults = {};

        // Production rates by building type and condition
        const productionRates = {
            rough: {
                office: { light: 300, moderate: 250, heavy: 200, extreme: 150 },
                medical: { light: 250, moderate: 200, heavy: 150, extreme: 125 },
                retail: { light: 325, moderate: 275, heavy: 225, extreme: 175 },
                industrial: { light: 350, moderate: 300, heavy: 250, extreme: 200 },
                education: { light: 275, moderate: 225, heavy: 175, extreme: 150 },
                hospitality: { light: 250, moderate: 200, heavy: 150, extreme: 125 },
                datacenter: { light: 200, moderate: 150, heavy: 125, extreme: 100 },
                highend: { light: 225, moderate: 175, heavy: 150, extreme: 125 }
            },
            final: {
                office: { light: 250, moderate: 200, heavy: 150, extreme: 125 },
                medical: { light: 200, moderate: 150, heavy: 125, extreme: 100 },
                retail: { light: 275, moderate: 225, heavy: 175, extreme: 150 },
                industrial: { light: 300, moderate: 250, heavy: 200, extreme: 175 },
                education: { light: 225, moderate: 175, heavy: 150, extreme: 125 },
                hospitality: { light: 200, moderate: 150, heavy: 125, extreme: 100 },
                datacenter: { light: 150, moderate: 125, heavy: 100, extreme: 75 },
                highend: { light: 175, moderate: 150, heavy: 125, extreme: 100 }
            },
            touchup: {
                office: { light: 450, moderate: 375, heavy: 300, extreme: 250 },
                medical: { light: 400, moderate: 325, heavy: 250, extreme: 200 },
                retail: { light: 475, moderate: 400, heavy: 325, extreme: 275 },
                industrial: { light: 500, moderate: 425, heavy: 350, extreme: 300 },
                education: { light: 425, moderate: 350, heavy: 275, extreme: 225 },
                hospitality: { light: 400, moderate: 325, heavy: 250, extreme: 200 },
                datacenter: { light: 350, moderate: 275, heavy: 225, extreme: 175 },
                highend: { light: 375, moderate: 300, heavy: 250, extreme: 200 }
            }
        };

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            // Set initial phase card states
            document.querySelectorAll('.phase-card').forEach(card => {
                card.classList.add('selected');
            });
            updateCalculations();
        });

        function togglePhase(phase) {
            phases[phase] = !phases[phase];
            const checkbox = document.getElementById(`phase${phase.charAt(0).toUpperCase() + phase.slice(1)}`);
            checkbox.checked = phases[phase];
            
            // Update phase card styling
            const cards = document.querySelectorAll('.phase-card');
            cards.forEach((card, index) => {
                const phaseNames = ['rough', 'final', 'touchup'];
                if (phaseNames[index] === phase) {
                    if (phases[phase]) {
                        card.classList.add('selected');
                    } else {
                        card.classList.remove('selected');
                    }
                }
            });
            
            updateCalculations();
        }

        function toggleProvider(category, type) {
            providers[category] = type;
            
            // Update button styling
            const buttons = document.querySelectorAll(`[data-category="${category}"]`);
            buttons.forEach(btn => {
                if (btn.classList.contains(`${type}-btn`)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            updateCalculations();
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatCurrencyDetailed(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        }

        function updateICBreakdown() {
            const baseRate = parseFloat(document.getElementById('laborRate').value) || 18;
            const stateTax = parseFloat(document.getElementById('stateTax').value) || 0;
            const icProfit = parseFloat(document.getElementById('icProfit').value) || 10;
            
            const fica = baseRate * 0.0765;
            const futa = baseRate * 0.006;
            const workComp = baseRate * 0.025;
            const gl = baseRate * 0.005;
            const stateTaxAmount = baseRate * (stateTax / 100);
            const suppliesEquipment = baseRate * 0.10; // 10% of base rate for supplies/equipment
            
            const subtotal = baseRate + fica + futa + workComp + gl + stateTaxAmount + suppliesEquipment;
            const icProfitAmount = subtotal * (icProfit / 100);
            const loadedRate = subtotal + icProfitAmount;
            
            document.getElementById('breakdownBase').textContent = formatCurrencyDetailed(baseRate);
            document.getElementById('breakdownFICA').textContent = formatCurrencyDetailed(fica);
            document.getElementById('breakdownFUTA').textContent = formatCurrencyDetailed(futa);
            document.getElementById('breakdownWC').textContent = formatCurrencyDetailed(workComp);
            document.getElementById('breakdownGL').textContent = formatCurrencyDetailed(gl);
            document.getElementById('breakdownState').textContent = formatCurrencyDetailed(stateTaxAmount);
            document.getElementById('breakdownSupplies').textContent = formatCurrencyDetailed(suppliesEquipment);
            document.getElementById('breakdownSubtotal').textContent = formatCurrencyDetailed(subtotal);
            document.getElementById('breakdownICProfit').textContent = formatCurrencyDetailed(icProfitAmount);
            document.getElementById('breakdownLoaded').textContent = formatCurrencyDetailed(loadedRate);
            
            return { subtotal, loadedRate };
        }

        function calculatePhaseHours(phase, sqft, buildingType, condition, complexity) {
            const baseRate = productionRates[phase][buildingType][condition];
            
            // Adjust for complexity
            let complexityMultiplier = 1;
            switch(complexity) {
                case 'simple': complexityMultiplier = 1.1; break;
                case 'moderate': complexityMultiplier = 1.0; break;
                case 'complex': complexityMultiplier = 0.9; break;
                case 'verycomplex': complexityMultiplier = 0.8; break;
            }
            
            // Adjust for multiple floors
            const floors = parseInt(document.getElementById('floors').value) || 1;
            const floorMultiplier = 1 - ((floors - 1) * 0.05); // 5% reduction per floor
            
            const adjustedRate = baseRate * complexityMultiplier * Math.max(floorMultiplier, 0.7);
            const hours = sqft / adjustedRate;
            
            return { hours, rate: adjustedRate };
        }

        function calculateEquipmentCost(phase, days) {
            const floorScrubbers = document.getElementById('floorScrubbers').value;
            const wetVacs = parseInt(document.getElementById('wetVacs').value) || 0;
            const lifts = document.getElementById('lifts').value;
            const sideBySide = document.getElementById('sideBySide').value;
            const dumpster = document.getElementById('dumpster').value;
            const generators = document.getElementById('generators').value;
            
            let dailyCost = 0;
            
            // Floor scrubbers (for general cleaning)
            if (floorScrubbers === '1') dailyCost += 150;
            else if (floorScrubbers === '2') dailyCost += 300;
            else if (floorScrubbers === '1r') dailyCost += 250;
            else if (floorScrubbers === '2r') dailyCost += 500;
            
            // Wet/Dry Vacuums - $50/day each
            dailyCost += wetVacs * 50;
            
            // Lifts
            if (lifts === 'scissor') dailyCost += 250;
            else if (lifts === 'boom') dailyCost += 500;
            else if (lifts === 'both') dailyCost += 750;
            
            // Side-by-Side/Utility Vehicle
            if (sideBySide === 'yes') dailyCost += 150;
            else if (sideBySide === 'multiple') dailyCost += 300;
            
            // Generators
            if (generators === 'small') dailyCost += 75;
            else if (generators === 'large') dailyCost += 200;
            
            // Phase-specific adjustments
            let phaseMultiplier = 1;
            if (phase === 'rough') phaseMultiplier = 0.8;  // More equipment needed in rough phase
            else if (phase === 'final') phaseMultiplier = 1.0;
            else if (phase === 'touchup') phaseMultiplier = 0.3;
            
            let totalEquipmentCost = dailyCost * days * phaseMultiplier;
            
            // Add one-time dumpster cost only to rough phase
            if (phase === 'rough' && dumpster !== 'no') {
                if (dumpster === 'small') totalEquipmentCost += 400;
                else if (dumpster === 'medium') totalEquipmentCost += 600;
                else if (dumpster === 'large') totalEquipmentCost += 800;
            }
            
            return totalEquipmentCost;
        }

        function updateCalculations() {
            updateICBreakdown();
            
            const sqft = parseFloat(document.getElementById('squareFootage').value) || 25000;
            const buildingType = document.getElementById('buildingType').value;
            const condition = document.getElementById('buildingCondition').value;
            const complexity = document.getElementById('buildingComplexity').value;
            const crewSize = parseInt(document.getElementById('crewSize').value) || 4;
            const supervisors = parseInt(document.getElementById('supervisors').value) || 1;
            const specialists = parseInt(document.getElementById('specialists').value) || 0;
            const timeOfService = document.getElementById('timeOfService').value;
            const region = document.getElementById('region').value;
            const competitionLevel = document.getElementById('competitionLevel').value;
            const cityWideMargin = parseFloat(document.getElementById('cityWideMargin').value) || 35;
            
            // Labor rates
            const laborRate = parseFloat(document.getElementById('laborRate').value) || 18;
            const supervisorRate = parseFloat(document.getElementById('supervisorRate').value) || 23;
            const specialistRate = parseFloat(document.getElementById('specialistRate').value) || 25;
            
            // Get loaded rates
            const { loadedRate } = updateICBreakdown();
            const supervisorLoaded = supervisorRate * 1.25; // Simplified for supervisors
            const specialistLoaded = specialistRate * 1.3; // Simplified for specialists
            
            // Time of service multiplier
            let timeMultiplier = 1;
            switch(timeOfService) {
                case 'evening': timeMultiplier = 1.15; break;
                case 'overnight': timeMultiplier = 1.25; break;
                case 'weekend': timeMultiplier = 1.20; break;
                case 'emergency': timeMultiplier = 1.35; break;
            }
            
            // Regional multiplier
            let regionalMultiplier = 1;
            switch(region) {
                case 'rural': regionalMultiplier = 0.75; break;
                case 'suburban': regionalMultiplier = 0.90; break;
                case 'urban': regionalMultiplier = 1.15; break;
                case 'major': regionalMultiplier = 1.25; break;
                case 'nyc': regionalMultiplier = 1.35; break;
            }
            
            // Competition adjustment
            let competitionAdjustment = 1;
            switch(competitionLevel) {
                case 'low': competitionAdjustment = 1.10; break;
                case 'high': competitionAdjustment = 0.95; break;
                case 'aggressive': competitionAdjustment = 0.90; break;
            }
            
            // Calculate for each phase
            let totalHours = 0;
            let totalLaborCost = 0;
            let totalEquipmentCost = 0;
            
            // Phase 1: Rough Clean
            if (phases.rough) {
                const rough = calculatePhaseHours('rough', sqft, buildingType, condition, complexity);
                const roughDays = Math.ceil(rough.hours / (crewSize * 8));
                
                // Calculate labor cost with crew composition (already includes supplies at 10%)
                const regularWorkers = Math.max(crewSize - supervisors - specialists, 0);
                const averageRate = (
                    (regularWorkers * loadedRate) +
                    (supervisors * supervisorLoaded) +
                    (specialists * specialistLoaded)
                ) / crewSize;
                
                const roughLaborCost = rough.hours * averageRate * timeMultiplier;
                const roughEquipment = calculateEquipmentCost('rough', roughDays);
                
                document.getElementById('roughHours').textContent = Math.round(rough.hours);
                document.getElementById('roughRate').textContent = Math.round(rough.rate) + ' sq ft/hr';
                document.getElementById('roughLabor').textContent = formatCurrency(roughLaborCost);
                document.getElementById('roughEquipment').textContent = formatCurrency(roughEquipment);
                document.getElementById('roughMaterials').textContent = 'Included';
                document.getElementById('roughTotal').textContent = formatCurrency(roughLaborCost + roughEquipment);
                
                totalHours += rough.hours;
                totalLaborCost += roughLaborCost;
                totalEquipmentCost += roughEquipment;
            } else {
                document.getElementById('roughHours').textContent = '0';
                document.getElementById('roughRate').textContent = 'N/A';
                document.getElementById('roughLabor').textContent = '$0';
                document.getElementById('roughEquipment').textContent = '$0';
                document.getElementById('roughMaterials').textContent = 'N/A';
                document.getElementById('roughTotal').textContent = '$0';
            }
            
            // Phase 2: Final Clean
            if (phases.final) {
                const final = calculatePhaseHours('final', sqft, buildingType, condition, complexity);
                const finalDays = Math.ceil(final.hours / (crewSize * 8));
                
                const regularWorkers = Math.max(crewSize - supervisors - specialists, 0);
                const averageRate = (
                    (regularWorkers * loadedRate) +
                    (supervisors * supervisorLoaded) +
                    (specialists * specialistLoaded)
                ) / crewSize;
                
                const finalLaborCost = final.hours * averageRate * timeMultiplier;
                const finalEquipment = calculateEquipmentCost('final', finalDays);
                
                document.getElementById('finalHours').textContent = Math.round(final.hours);
                document.getElementById('finalRate').textContent = Math.round(final.rate) + ' sq ft/hr';
                document.getElementById('finalLabor').textContent = formatCurrency(finalLaborCost);
                document.getElementById('finalEquipment').textContent = formatCurrency(finalEquipment);
                document.getElementById('finalMaterials').textContent = 'Included';
                document.getElementById('finalTotal').textContent = formatCurrency(finalLaborCost + finalEquipment);
                
                totalHours += final.hours;
                totalLaborCost += finalLaborCost;
                totalEquipmentCost += finalEquipment;
            } else {
                document.getElementById('finalHours').textContent = '0';
                document.getElementById('finalRate').textContent = 'N/A';
                document.getElementById('finalLabor').textContent = '$0';
                document.getElementById('finalEquipment').textContent = '$0';
                document.getElementById('finalMaterials').textContent = 'N/A';
                document.getElementById('finalTotal').textContent = '$0';
            }
            
            // Phase 3: Touch-Up
            if (phases.touchup) {
                const touchup = calculatePhaseHours('touchup', sqft, buildingType, condition, complexity);
                const touchupDays = Math.ceil(touchup.hours / (crewSize * 8));
                
                const regularWorkers = Math.max(crewSize - supervisors - specialists, 0);
                const averageRate = (
                    (regularWorkers * loadedRate) +
                    (supervisors * supervisorLoaded) +
                    (specialists * specialistLoaded)
                ) / crewSize;
                
                const touchupLaborCost = touchup.hours * averageRate * timeMultiplier;
                const touchupEquipment = calculateEquipmentCost('touchup', touchupDays);
                
                document.getElementById('touchupHours').textContent = Math.round(touchup.hours);
                document.getElementById('touchupRate').textContent = Math.round(touchup.rate) + ' sq ft/hr';
                document.getElementById('touchupLabor').textContent = formatCurrency(touchupLaborCost);
                document.getElementById('touchupEquipment').textContent = formatCurrency(touchupEquipment);
                document.getElementById('touchupMaterials').textContent = 'Included';
                document.getElementById('touchupTotal').textContent = formatCurrency(touchupLaborCost + touchupEquipment);
                
                totalHours += touchup.hours;
                totalLaborCost += touchupLaborCost;
                totalEquipmentCost += touchupEquipment;
            } else {
                document.getElementById('touchupHours').textContent = '0';
                document.getElementById('touchupRate').textContent = 'N/A';
                document.getElementById('touchupLabor').textContent = '$0';
                document.getElementById('touchupEquipment').textContent = '$0';
                document.getElementById('touchupMaterials').textContent = 'N/A';
                document.getElementById('touchupTotal').textContent = '$0';
            }
            
            // Apply provider logic
            if (providers.labor === 'vendor') {
                totalLaborCost *= 1.10; // Add IC profit for vendor
            }
            if (providers.equipment === 'vendor') {
                totalEquipmentCost *= 1.10;
            }
            
            // Apply regional and competition adjustments
            totalLaborCost *= regionalMultiplier * competitionAdjustment;
            totalEquipmentCost *= regionalMultiplier * competitionAdjustment;
            
            // Calculate totals (no separate materials cost since it's in labor)
            const totalCostToCW = totalLaborCost + totalEquipmentCost;
            const clientPrice = totalCostToCW / (1 - cityWideMargin / 100);
            const grossProfit = clientPrice - totalCostToCW;
            const vendorPayment = totalCostToCW;
            const totalDays = Math.ceil(totalHours / (crewSize * 8));
            const pricePerSqFt = clientPrice / sqft;
            const perPhaseAvg = clientPrice / Object.values(phases).filter(p => p).length;
            
            // Update display
            document.getElementById('totalHours').textContent = Math.round(totalHours);
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('totalLabor').textContent = formatCurrency(totalLaborCost);
            document.getElementById('totalEquipment').textContent = formatCurrency(totalEquipmentCost);
            document.getElementById('totalMaterials').textContent = 'Included in Labor';
            document.getElementById('totalCostToCW').textContent = formatCurrency(totalCostToCW);
            document.getElementById('pricePerSqFt').textContent = formatCurrencyDetailed(pricePerSqFt);
            document.getElementById('clientPrice').textContent = formatCurrency(clientPrice);
            document.getElementById('grossProfit').textContent = formatCurrency(grossProfit);
            document.getElementById('vendorPayment').textContent = formatCurrency(vendorPayment);
            document.getElementById('perPhaseAvg').textContent = formatCurrency(perPhaseAvg);
            document.getElementById('profitPercent').textContent = cityWideMargin + '%';
            
            // Store results for exports
            calculationResults = {
                sqft,
                buildingType,
                condition,
                complexity,
                crewSize,
                totalHours,
                totalDays,
                totalLaborCost,
                totalEquipmentCost,
                totalMaterialsCost: 0, // Materials now included in labor
                totalCostToCW,
                clientPrice,
                grossProfit,
                vendorPayment,
                pricePerSqFt,
                cityWideMargin,
                phases,
                providers
            };
        }

        // Export functions
        function downloadRTF(content, filename) {
            const blob = new Blob([content], { type: 'application/rtf' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function exportVendorSpecs() {
            const rtf = `{\\rtf1\\ansi\\deff0 {\\fonttbl{\\f0 Times New Roman;}}
\\f0\\fs24
{\\b VENDOR SPECIFICATIONS - POST-CONSTRUCTION CLEANING}\\line\\line
Generated: ${new Date().toLocaleDateString()}\\line\\line

{\\b PROJECT OVERVIEW}\\line
Square Footage: ${calculationResults.sqft.toLocaleString()} sq ft\\line
Building Type: ${document.getElementById('buildingType').selectedOptions[0].text}\\line
Building Condition: ${document.getElementById('buildingCondition').selectedOptions[0].text}\\line
Building Complexity: ${document.getElementById('buildingComplexity').selectedOptions[0].text}\\line
Number of Floors: ${document.getElementById('floors').value}\\line\\line

{\\b PHASES INCLUDED}\\line
${phases.rough ? '- Phase 1: Rough Clean\\line' : ''}
${phases.final ? '- Phase 2: Final Clean\\line' : ''}
${phases.touchup ? '- Phase 3: Touch-Up Clean\\line' : ''}
\\line

{\\b LABOR REQUIREMENTS}\\line
Total Labor Hours: ${Math.round(calculationResults.totalHours)} hours\\line
Crew Size: ${calculationResults.crewSize} workers\\line
Estimated Days: ${calculationResults.totalDays} days\\line
Base Labor Rate: ${document.getElementById('laborRate').value}/hour\\line\\line

{\\b EQUIPMENT NEEDED}\\line
HEPA Vacuums: ${document.getElementById('hepaVacuums').value} units\\line
Floor Scrubbers: ${document.getElementById('floorScrubbers').selectedOptions[0].text}\\line
Lifts: ${document.getElementById('lifts').selectedOptions[0].text}\\line
Pressure Washer: ${document.getElementById('pressureWasher').selectedOptions[0].text}\\line
Window Equipment: ${document.getElementById('windowEquipment').selectedOptions[0].text}\\line\\line

{\\b MATERIALS REQUIRED}\\line
Floor Stripper: ${Math.ceil(calculationResults.sqft / 600)} gallons\\line
Floor Finish: ${Math.ceil(calculationResults.sqft / 2000 * parseInt(document.getElementById('finishCoats').value))} gallons\\line
All-Purpose Cleaner: ${Math.ceil(calculationResults.sqft / 5000)} gallons\\line
Glass Cleaner: ${Math.ceil(calculationResults.sqft * 0.1 / 1000)} gallons\\line
Disposable Supplies: Based on ${calculationResults.sqft.toLocaleString()} sq ft\\line\\line

{\\b QUALITY STANDARDS}\\line
- All surfaces must be free of construction dust and debris\\line
- Windows cleaned inside and out to streak-free finish\\line
- Floors stripped and refinished with ${document.getElementById('finishCoats').value} coats\\line
- All fixtures, outlets, and switches cleaned and polished\\line
- HVAC vents and returns vacuumed and wiped\\line
- Light fixtures cleaned and bulbs replaced as needed\\line\\line

{\\b SAFETY REQUIREMENTS}\\line
- All workers must wear appropriate PPE\\line
- HEPA filtration required for dust control\\line
- Proper ventilation during chemical application\\line
- Fall protection for work above 6 feet\\line
- Current insurance certificates required\\line\\line

{\\b COMPLETION TIMELINE}\\line
Phase 1 (Rough): ${phases.rough ? Math.ceil(document.getElementById('roughHours').textContent / (calculationResults.crewSize * 8)) + ' days' : 'Not included'}\\line
Phase 2 (Final): ${phases.final ? Math.ceil(document.getElementById('finalHours').textContent / (calculationResults.crewSize * 8)) + ' days' : 'Not included'}\\line
Phase 3 (Touch-up): ${phases.touchup ? Math.ceil(document.getElementById('touchupHours').textContent / (calculationResults.crewSize * 8)) + ' days' : 'Not included'}\\line
Total Project Duration: ${calculationResults.totalDays} working days\\line
}`;
            
            downloadRTF(rtf, 'vendor-specifications.rtf');
        }

        function exportClientInstructions() {
            const rtf = `{\\rtf1\\ansi\\deff0 {\\fonttbl{\\f0 Times New Roman;}}
\\f0\\fs24
{\\b CLIENT INSTRUCTIONS - POST-CONSTRUCTION CLEANING}\\line\\line
Generated: ${new Date().toLocaleDateString()}\\line\\line

{\\b SERVICE OVERVIEW}\\line
City Wide will provide comprehensive post-construction cleaning services for your ${calculationResults.sqft.toLocaleString()} sq ft facility. Our three-phase approach ensures your space is move-in ready and exceeds industry standards.\\line\\line

{\\b THREE-PHASE CLEANING PROCESS}\\line\\line

${phases.rough ? `{\\b Phase 1: Rough Clean (40-50% of project time)}\\line
- Remove all construction debris and trash\\line
- Sweep and vacuum all surfaces\\line
- Wipe down all surfaces to remove dust\\line
- Clean and disinfect restrooms\\line
- Remove protective coverings from fixtures\\line\\line` : ''}

${phases.final ? `{\\b Phase 2: Final Clean (40-45% of project time)}\\line
- Wet mop all hard floor surfaces\\line
- Deep vacuum all carpeted areas\\line
- Clean and polish all fixtures and hardware\\line
- Sanitize all touchpoints and surfaces\\line
- Clean HVAC vents and returns\\line
- Detail clean kitchens and break rooms\\line
- Clean all baseboards and trim\\line\\line` : ''}

${phases.touchup ? `{\\b Phase 3: Touch-Up Clean (10-15% of project time)}\\line
- Final inspection and quality check\\line
- Spot clean any missed areas\\line
- Remove any fingerprints or smudges\\line
- Prepare space for final walkthrough\\line\\line` : ''}

{\\b SERVICES NOT INCLUDED}\\line
Please note that the following services are NOT included in this quote:\\line
- Strip and Wax services\\line
- Window cleaning (interior and exterior)\\line
- Carpet cleaning/extraction\\line
- Pressure washing\\line
- High dusting above 20 feet\\line\\line

{\\b CLIENT PREPARATION REQUIREMENTS}\\line
- Ensure all construction work is complete\\line
- Provide access to water and electricity\\line
- Clear pathways for equipment movement\\line
- Remove or secure valuable items\\line
- Provide parking for crew vehicles\\line
- Designate area for waste disposal\\line\\line

{\\b TIMING AND SCHEDULING}\\line
Service Schedule: ${document.getElementById('timeOfService').selectedOptions[0].text}\\line
Estimated Duration: ${calculationResults.totalDays} working days\\line
Crew Size: ${calculationResults.crewSize} trained professionals\\line\\line

{\\b POST-SERVICE MAINTENANCE}\\line
- Maintain regular cleaning schedule\\line
- Keep HVAC filters clean to minimize dust\\line
- Address spills and stains promptly\\line
- Schedule periodic deep cleaning as needed\\line\\line

{\\b QUALITY ASSURANCE}\\line
- Pre-service walkthrough to identify specific concerns\\line
- Daily progress reports during service\\line
- Final inspection with client representative\\line
- 48-hour callback guarantee for any issues\\line
- Detailed completion certificate provided\\line\\line

{\\b SAFETY MEASURES}\\line
- All crew members are fully insured and bonded\\line
- OSHA-compliant safety procedures followed\\line
- Non-toxic, eco-friendly cleaning products available\\line
- Proper ventilation maintained during service\\line\\line

{\\b CONTACT INFORMATION}\\line
For questions or concerns during service, please contact your City Wide Facility Solutions Manager.\\line
Emergency after-hours support available.\\line
}`;
            
            downloadRTF(rtf, 'client-instructions.rtf');
        }

        function exportFSMSummary() {
            const rtf = `{\\rtf1\\ansi\\deff0 {\\fonttbl{\\f0 Times New Roman;}}
\\f0\\fs24
{\\b FACILITY SOLUTIONS MANAGER - COMPLETE JOB SUMMARY}\\line\\line
Service: Post-Construction Cleaning\\line
Location: ${calculationResults.sqft.toLocaleString()} sq ft ${document.getElementById('buildingType').selectedOptions[0].text}\\line
Generated: ${new Date().toLocaleString()}\\line\\line

{\\b\\fs28 JOB OVERVIEW}\\line\\line
Square Footage: ${calculationResults.sqft.toLocaleString()} sq ft\\line
Building Type: ${document.getElementById('buildingType').selectedOptions[0].text}\\line
Post-Construction Condition: ${document.getElementById('buildingCondition').selectedOptions[0].text}\\line
Complexity Level: ${document.getElementById('buildingComplexity').selectedOptions[0].text}\\line
Number of Floors: ${document.getElementById('floors').value}\\line
Service Schedule: ${document.getElementById('timeOfService').selectedOptions[0].text}\\line\\line

Total Labor Hours: ${Math.round(calculationResults.totalHours)} hours\\line
Recommended Crew Size: ${calculationResults.crewSize} workers\\line
Project Duration: ${calculationResults.totalDays} days\\line\\line

{\\b\\fs28 PRICING SUMMARY}\\line\\line
{\\b Final Client Price: ${formatCurrency(calculationResults.clientPrice)}}\\line
Total Vendor Payment: ${formatCurrency(calculationResults.vendorPayment)}\\line
{\\b City Wide Gross Profit: ${formatCurrency(calculationResults.grossProfit)}}\\line
City Wide Margin: ${calculationResults.cityWideMargin}%\\line
Price Per Square Foot: ${formatCurrencyDetailed(calculationResults.pricePerSqFt)}\\line\\line

{\\b\\fs28 VENDOR PAYMENT STRUCTURE}\\line\\line
{\\b Cost Provider Selections:}\\line
Labor: ${providers.labor === 'vendor' ? 'Vendor Provided (includes 10% IC profit)' : 'In-House (no IC profit)'}\\line
Equipment: ${providers.equipment === 'vendor' ? 'Vendor Provided (includes 10% IC profit)' : 'In-House (no IC profit)'}\\line
Supplies: ${providers.supplies === 'vendor' ? 'Vendor Provided (includes 10% IC profit)' : 'In-House (no IC profit)'}\\line\\line

{\\b Labor Rate Breakdown:}\\line
Base Rate: ${document.getElementById('laborRate').value}/hour\\line
FICA (7.65%): ${(parseFloat(document.getElementById('laborRate').value) * 0.0765).toFixed(2)}\\line
FUTA (0.60%): ${(parseFloat(document.getElementById('laborRate').value) * 0.006).toFixed(2)}\\line
Work Comp (2.50%): ${(parseFloat(document.getElementById('laborRate').value) * 0.025).toFixed(2)}\\line
GL (0.50%): ${(parseFloat(document.getElementById('laborRate').value) * 0.005).toFixed(2)}\\line
State Tax: ${(parseFloat(document.getElementById('laborRate').value) * parseFloat(document.getElementById('stateTax').value) / 100).toFixed(2)}\\line
${providers.labor === 'vendor' ? 'IC Profit (10%): Included\\line' : ''}
\\line

{\\b\\fs28 SITE CONDITIONS & CHALLENGES}\\line\\line
- Condition: ${document.getElementById('buildingCondition').selectedOptions[0].text}\\line
- Complexity: ${document.getElementById('buildingComplexity').selectedOptions[0].text}\\line
- Multiple floors: ${document.getElementById('floors').value > 1 ? 'Yes - requires additional coordination' : 'No'}\\line
- After-hours work: ${document.getElementById('timeOfService').value !== 'normal' ? 'Yes - premium rates apply' : 'No'}\\line
- Regional market: ${document.getElementById('region').selectedOptions[0].text}\\line
- Competition level: ${document.getElementById('competitionLevel').selectedOptions[0].text}\\line\\line

{\\b\\fs28 VENDOR QUESTIONS TO ASK}\\line\\line
1. Do you have experience with post-construction cleaning for ${document.getElementById('buildingType').selectedOptions[0].text} facilities?\\line
2. Can you provide ${document.getElementById('hepaVacuums').value} HEPA vacuums and necessary equipment?\\line
3. Do you have current general liability and workers comp insurance?\\line
4. Can you commit to ${calculationResults.totalDays} consecutive days of work?\\line
5. Do you have a crew of at least ${calculationResults.crewSize} trained workers available?\\line
6. Are you familiar with floor stripping and refinishing procedures?\\line
7. Do you have proper safety equipment for working at heights?\\line\\line

{\\b\\fs28 CLIENT COMMUNICATION POINTS}\\line\\line
{\\b Pre-Service:}\\line
- Confirm all construction work is complete\\line
- Ensure utilities are connected and operational\\line
- Verify access to all areas requiring cleaning\\line
- Discuss any specific areas of concern\\line\\line

{\\b During Service:}\\line
- Provide daily progress updates\\line
- Address any unexpected conditions immediately\\line
- Maintain clear communication channels\\line
- Document work with before/after photos\\line\\line

{\\b Post-Service:}\\line
- Conduct thorough walkthrough with client\\line
- Provide care and maintenance instructions\\line
- Establish callback procedure for any issues\\line
- Schedule follow-up quality check\\line\\line

{\\b\\fs28 SCHEDULING CONSIDERATIONS}\\line\\line
- Optimal timing: After all trades complete, before move-in\\line
- Weather concerns: High humidity affects floor finish drying\\line
- Coordination required with other contractors\\line
- Allow 24-hour cure time for floor finish before occupancy\\line
- ${document.getElementById('timeOfService').value !== 'normal' ? 'Special scheduling for after-hours work required\\line' : ''}
- Consider phased approach if building partially occupied\\line\\line

{\\b\\fs28 QUALITY ASSURANCE CHECKLIST}\\line\\line
{\\b Phase 1 - Rough Clean:}\\line
[ ] All construction debris removed\\line
[ ] Surfaces swept and vacuumed\\line
[ ] Windows cleaned (first pass)\\line
[ ] Restrooms sanitized\\line\\line

{\\b Phase 2 - Final Clean:}\\line
[ ] Floors stripped and refinished\\line
[ ] All windows cleaned inside/out\\line
[ ] Fixtures polished\\line
[ ] HVAC vents cleaned\\line
[ ] Kitchen/break areas detailed\\line\\line

{\\b Phase 3 - Touch-Up:}\\line
[ ] Final inspection completed\\line
[ ] Spot cleaning performed\\line
[ ] Client walkthrough scheduled\\line
[ ] Punch list items addressed\\line\\line

{\\b\\fs28 PROFITABILITY ANALYSIS}\\line\\line
Client Payment: ${formatCurrency(calculationResults.clientPrice)}\\line
Less Vendor Payment: ${formatCurrency(calculationResults.vendorPayment)}\\line
{\\b City Wide Profit: ${formatCurrency(calculationResults.grossProfit)}}\\line\\line

{\\b Key Cost Drivers:}\\line
- Labor: ${formatCurrency(calculationResults.totalLaborCost)} (${(calculationResults.totalLaborCost / calculationResults.totalCostToCW * 100).toFixed(1)}% of costs)\\line
- Equipment: ${formatCurrency(calculationResults.totalEquipmentCost)} (${(calculationResults.totalEquipmentCost / calculationResults.totalCostToCW * 100).toFixed(1)}% of costs)\\line
- Materials: ${formatCurrency(calculationResults.totalMaterialsCost)} (${(calculationResults.totalMaterialsCost / calculationResults.totalCostToCW * 100).toFixed(1)}% of costs)\\line\\line

{\\b Risk Factors:}\\line
- Condition worse than assessed\\line
- Hidden areas requiring additional work\\line
- Delays from other contractors\\line
- Weather impacts on scheduling\\line
- Quality callbacks\\line\\line

{\\b Success Factors:}\\line
- Experienced crew with proper equipment\\line
- Clear communication with all parties\\line
- Adequate time allocation per phase\\line
- Quality control at each phase\\line
- Proper floor finish application\\line
}`;
            
            downloadRTF(rtf, 'fsm-job-summary.rtf');
        }

        function generateScope() {
            const rtf = `{\\rtf1\\ansi\\deff0 {\\fonttbl{\\f0 Times New Roman;}}
\\f0\\fs24
{\\b PROJECT SCOPE - POST-CONSTRUCTION CLEANING}\\line\\line
Project: ${calculationResults.sqft.toLocaleString()} sq ft ${document.getElementById('buildingType').selectedOptions[0].text}\\line
Date: ${new Date().toLocaleDateString()}\\line\\line

{\\b SCOPE OF WORK}\\line\\line

This scope defines the post-construction cleaning services to be provided by City Wide Facility Solutions for the above-referenced project.\\line\\line

{\\b 1. PROJECT DETAILS}\\line
- Total Square Footage: ${calculationResults.sqft.toLocaleString()} sq ft\\line
- Building Type: ${document.getElementById('buildingType').selectedOptions[0].text}\\line
- Number of Floors: ${document.getElementById('floors').value}\\line
- Current Condition: ${document.getElementById('buildingCondition').selectedOptions[0].text}\\line\\line

{\\b 2. SERVICES INCLUDED}\\line\\line

${phases.rough ? `{\\b Phase 1 - Rough Clean:}\\line
- Remove all construction debris, trash, and packaging materials\\line
- Sweep and vacuum all floor surfaces\\line
- Dust all horizontal and vertical surfaces\\line
- Wipe down walls and remove marks/stains\\line
- Clean and disinfect all restrooms\\line
- Remove protective coverings from fixtures\\line\\line` : ''}

${phases.final ? `{\\b Phase 2 - Final Clean:}\\line
- Wet mop all hard floor surfaces\\line
- Deep vacuum all carpeted areas with HEPA filtration\\line
- Detail clean all doors, frames, and hardware\\line
- Clean all HVAC vents, returns, and diffusers\\line
- Sanitize all kitchens, break rooms, and appliances\\line
- Clean and disinfect all restroom fixtures\\line
- Polish all stainless steel and chrome surfaces\\line
- Clean all baseboards and crown molding\\line
- Vacuum and wipe all blinds/window treatments\\line\\line` : ''}

${phases.touchup ? `{\\b Phase 3 - Touch-Up Clean:}\\line
- Perform detailed quality inspection\\line
- Address any areas requiring additional attention\\line
- Remove fingerprints and smudges from all surfaces\\line
- Touch-up clean as needed\\line
- Prepare space for client inspection\\line
- Complete final walkthrough checklist\\line\\line` : ''}

{\\b 3. SERVICES EXPLICITLY EXCLUDED}\\line
The following services are NOT included and must be quoted separately:\\line
- Strip and Wax floor services\\line
- Interior and exterior window cleaning\\line
- Carpet cleaning/extraction services\\line
- Pressure washing services\\line
- High dusting above 20 feet\\line
- Exterior building cleaning\\line
- Upholstery cleaning\\line
- Construction material disposal fees\\line\\line

{\\b 4. EQUIPMENT AND MATERIALS}\\line
City Wide will provide all necessary equipment and materials including:\\line
- HEPA-filtered vacuums (${document.getElementById('hepaVacuums').value} units)\\line
- Floor scrubbing equipment\\line
- All cleaning chemicals and supplies\\line
- Safety equipment and PPE\\line
- Dust mop systems and cleaning carts\\line\\line

{\\b 5. TIMELINE}\\line
- Start Date: TBD\\line
- Duration: ${calculationResults.totalDays} working days\\line
- Working Hours: ${document.getElementById('timeOfService').selectedOptions[0].text}\\line
- Crew Size: ${calculationResults.crewSize} workers\\line\\line

{\\b 6. PRICING}\\line
Total Project Price: ${formatCurrency(calculationResults.clientPrice)}\\line
Price Per Square Foot: ${formatCurrencyDetailed(calculationResults.pricePerSqFt)}\\line
Payment Terms: Net 30\\line\\line

{\\b 7. EXCLUSIONS}\\line
The following items are NOT included in this scope:\\line
- Removal of hazardous materials\\line
- Painting or drywall repair\\line
- Electrical or plumbing work\\line
- Moving furniture or equipment\\line
- Disposal fees exceeding normal construction debris\\line\\line

{\\b 8. CLIENT RESPONSIBILITIES}\\line
- Provide access to all areas requiring cleaning\\line
- Ensure utilities (water, electricity) are operational\\line
- Remove or secure valuable items\\line
- Provide designated area for waste disposal\\line
- Clear work areas of ongoing construction\\line\\line

{\\b 9. QUALITY ASSURANCE}\\line
- Pre-service walkthrough to identify specific requirements\\line
- Daily progress reporting\\line
- Final inspection with client representative\\line
- 48-hour callback guarantee\\line
- Written completion certificate\\line\\line

{\\b 10. INSURANCE AND COMPLIANCE}\\line
- General Liability Insurance: $2,000,000\\line
- Workers Compensation: As required by law\\line
- All work performed to industry standards\\line
- OSHA safety compliance\\line\\line

{\\b 11. ACCEPTANCE}\\line\\line
Client: _________________________  Date: __________\\line\\line
City Wide: ______________________  Date: __________\\line
}`;
            
            downloadRTF(rtf, 'project-scope.rtf');
        }
    </script>
</body>
</html>
